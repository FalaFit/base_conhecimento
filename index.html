<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Pol√≠ticas Inteligente</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
            50% { box-shadow: 0 0 30px rgba(59, 130, 246, 0.5); }
        }
        
        .pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .animate-shake {
            animation: shake 0.5s;
        }

        .hidden { display: none; }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 min-h-screen">
    <!-- Tela de Login -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center px-4">
        <div class="absolute inset-0 overflow-hidden pointer-events-none">
            <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-blue-500/10 rounded-full blur-3xl"></div>
            <div class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-purple-500/10 rounded-full blur-3xl"></div>
        </div>

        <div class="w-full max-w-md relative animate-fade-in">
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl shadow-2xl pulse-glow mb-6">
                    <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                </div>
                <h1 class="text-3xl font-bold text-white mb-2">Sistema de Pol√≠ticas</h1>
                <p class="text-slate-400">Acesso seguro ao sistema de consultas</p>
            </div>

            <div id="loginCard" class="bg-slate-800/50 backdrop-blur-xl rounded-2xl border border-slate-700 shadow-2xl overflow-hidden">
                <div class="p-8">
                    <form id="loginForm" class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Usu√°rio</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <svg class="h-5 w-5 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                    </svg>
                                </div>
                                <input
                                    type="text"
                                    id="username"
                                    class="w-full bg-slate-900/50 text-white placeholder-slate-500 rounded-xl border border-slate-600 pl-10 pr-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                    placeholder="Digite seu usu√°rio"
                                    required
                                />
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Senha</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <svg class="h-5 w-5 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                    </svg>
                                </div>
                                <input
                                    type="password"
                                    id="password"
                                    class="w-full bg-slate-900/50 text-white placeholder-slate-500 rounded-xl border border-slate-600 pl-10 pr-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                    placeholder="Digite sua senha"
                                    required
                                />
                            </div>
                        </div>

                        <div id="loginError" class="hidden bg-red-500/10 border border-red-500/50 rounded-xl p-3 flex items-center gap-2">
                            <svg class="w-5 h-5 text-red-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <p class="text-sm text-red-300">Usu√°rio ou senha incorretos</p>
                        </div>

                        <button
                            type="submit"
                            id="loginButton"
                            class="w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-200 shadow-lg hover:shadow-blue-500/50"
                        >
                            Entrar no Sistema
                        </button>
                    </form>
                </div>

                <div class="bg-slate-900/30 px-8 py-4 border-t border-slate-700">
                    <p class="text-xs text-slate-500 text-center">üîí Sess√£o expira em 2 horas de inatividade</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Aplica√ß√£o Principal -->
    <div id="mainApp" class="hidden min-h-screen animate-fade-in">
        <!-- Header -->
        <div class="bg-slate-800/50 backdrop-blur-sm border-b border-slate-700 sticky top-0 z-10">
            <div class="max-w-6xl mx-auto px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-white">Sistema de Pol√≠ticas Inteligente</h1>
                            <p class="text-sm text-slate-400">Consulte pol√≠ticas com IA</p>
                        </div>
                    </div>
                    <button
                        id="logoutButton"
                        class="px-4 py-2 bg-slate-700/50 hover:bg-slate-700 text-slate-300 rounded-lg transition-colors text-sm"
                    >
                        Sair
                    </button>
                </div>
            </div>
        </div>

        <!-- Conte√∫do -->
        <div class="max-w-6xl mx-auto px-6 py-8">
            <!-- Input Area -->
            <div class="bg-slate-800/50 backdrop-blur-sm rounded-2xl border border-slate-700 p-6 mb-6 shadow-2xl">
                <label class="block text-sm font-medium text-slate-300 mb-3">
                    Fa√ßa sua pergunta sobre as pol√≠ticas:
                </label>
                
                <div class="flex gap-3">
                    <textarea
                        id="perguntaInput"
                        placeholder="Ex: Qual a pol√≠tica sobre trabalho remoto?"
                        class="flex-1 bg-slate-900/50 text-white placeholder-slate-500 rounded-xl border border-slate-600 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                        rows="3"
                    ></textarea>
                    
                    <button
                        id="consultarButton"
                        class="bg-blue-500 hover:bg-blue-600 disabled:bg-slate-700 disabled:cursor-not-allowed text-white px-6 rounded-xl transition-all duration-200 flex items-center gap-2 font-medium shadow-lg hover:shadow-blue-500/50"
                    >
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                        </svg>
                        Consultar
                    </button>
                </div>

                <!-- Exemplos -->
<div id="exemplosArea" class="mt-4">
    <p class="text-xs text-slate-400 mb-3">üí° Exemplos de perguntas:</p>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2">
        <button class="exemplo-btn text-xs bg-slate-700/50 hover:bg-slate-600/50 text-slate-300 px-3 py-2 rounded-lg transition-colors text-left">
            Quais pol√≠ticas corporativas temos?
        </button>
        <button class="exemplo-btn text-xs bg-slate-700/50 hover:bg-slate-600/50 text-slate-300 px-3 py-2 rounded-lg transition-colors text-left">
            Regras sobre presentes e brindes
        </button>
        <button class="exemplo-btn text-xs bg-slate-700/50 hover:bg-slate-600/50 text-slate-300 px-3 py-2 rounded-lg transition-colors text-left">
            Como funciona nossa pol√≠tica anticorrup√ß√£o?
        </button>
        <button class="exemplo-btn text-xs bg-slate-700/50 hover:bg-slate-600/50 text-slate-300 px-3 py-2 rounded-lg transition-colors text-left">
            O que diz sobre prote√ß√£o de dados pessoais?
        </button>
        <button class="exemplo-btn text-xs bg-slate-700/50 hover:bg-slate-600/50 text-slate-300 px-3 py-2 rounded-lg transition-colors text-left">
            Pol√≠tica de responsabilidade socioambiental
        </button>
        <button class="exemplo-btn text-xs bg-slate-700/50 hover:bg-slate-600/50 text-slate-300 px-3 py-2 rounded-lg transition-colors text-left">
            Diretrizes sobre lavagem de dinheiro
        </button>
    </div>
</div>

            <!-- Error Message -->
            <div id="errorArea" class="hidden bg-red-500/10 border border-red-500/50 rounded-xl p-4 mb-6 animate-fade-in">
                <div class="flex items-start gap-3">
                    <svg class="w-5 h-5 text-red-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <div class="flex-1">
                        <p class="text-red-300 font-medium">Erro ao consultar</p>
                        <p id="errorMessage" class="text-red-200/80 text-sm mt-1"></p>
                    </div>
                </div>
            </div>

            <!-- Loading State -->
            <div id="loadingArea" class="hidden bg-slate-800/50 backdrop-blur-sm rounded-2xl border border-slate-700 p-8 text-center animate-fade-in">
                <svg class="animate-spin h-12 w-12 text-blue-400 mx-auto mb-4" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <p class="text-slate-300">Analisando documentos...</p>
                <p class="text-slate-500 text-sm mt-2">Buscando as informa√ß√µes mais relevantes</p>
            </div>

            <!-- Response Area -->
            <div id="respostaArea" class="hidden bg-slate-800/50 backdrop-blur-sm rounded-2xl border border-slate-700 overflow-hidden shadow-2xl animate-fade-in">
                <div class="bg-green-500/10 border-b border-slate-700 px-6 py-3 flex items-center gap-2">
                    <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span class="text-green-300 font-medium">Resposta encontrada</span>
                </div>

                <div class="p-6">
                    <div id="respostaTexto" class="text-slate-100 leading-relaxed whitespace-pre-wrap"></div>
                    
                    <div class="mt-4 pt-4 border-t border-slate-700/50 flex items-center justify-end text-xs text-slate-500">
    <span id="respostaTimestamp"></span>
</div>

    <script>
        // CONFIGURA√á√ïES
        const CONFIG = {
            username: 'admin',
            password: 'mvpmvp',
            // URL original do n8n (vamos tentar uma abordagem diferente)
            webhookUrl: 'https://base-conhecimento-peach.vercel.app/api/webhook',
            sessionTimeout: 2 * 60 * 60 * 1000 // 2 horas
        };

        // Elementos
        const loginScreen = document.getElementById('loginScreen');
        const mainApp = document.getElementById('mainApp');
        const loginForm = document.getElementById('loginForm');
        const loginCard = document.getElementById('loginCard');
        const loginError = document.getElementById('loginError');
        const perguntaInput = document.getElementById('perguntaInput');
        const consultarButton = document.getElementById('consultarButton');
        const exemplosArea = document.getElementById('exemplosArea');
        const errorArea = document.getElementById('errorArea');
        const errorMessage = document.getElementById('errorMessage');
        const loadingArea = document.getElementById('loadingArea');
        const respostaArea = document.getElementById('respostaArea');
        const respostaTexto = document.getElementById('respostaTexto');
        const respostaModelo = document.getElementById('respostaModelo');
        const respostaTimestamp = document.getElementById('respostaTimestamp');
        const logoutButton = document.getElementById('logoutButton');

        // Verifica autentica√ß√£o inicial
        function checkAuth() {
            const authDataStr = localStorage.getItem('authData');
            
            if (authDataStr) {
                try {
                    const authData = JSON.parse(authDataStr);
                    const now = Date.now();
                    
                    if (authData.expiresAt && now > authData.expiresAt) {
                        localStorage.removeItem('authData');
                        showLogin();
                    } else if (authData.authenticated) {
                        showMainApp();
                    } else {
                        showLogin();
                    }
                } catch (e) {
                    localStorage.removeItem('authData');
                    showLogin();
                }
            } else {
                showLogin();
            }
        }

        // Mostra tela de login
        function showLogin() {
            loginScreen.classList.remove('hidden');
            mainApp.classList.add('hidden');
        }

        // Mostra aplica√ß√£o principal
        function showMainApp() {
            loginScreen.classList.add('hidden');
            mainApp.classList.remove('hidden');
        }

        // Login
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            loginError.classList.add('hidden');
            
            if (username === CONFIG.username && password === CONFIG.password) {
                const loginData = {
                    authenticated: true,
                    timestamp: Date.now(),
                    expiresAt: Date.now() + CONFIG.sessionTimeout
                };
                localStorage.setItem('authData', JSON.stringify(loginData));
                showMainApp();
            } else {
                loginError.classList.remove('hidden');
                loginCard.classList.add('animate-shake');
                setTimeout(() => loginCard.classList.remove('animate-shake'), 500);
            }
        });

        // Logout
        logoutButton.addEventListener('click', () => {
            localStorage.removeItem('authData');
            showLogin();
        });

        // Consultar
        consultarButton.addEventListener('click', fazerPergunta);

        // Exemplos
        document.querySelectorAll('.exemplo-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                perguntaInput.value = btn.textContent.trim();
            });
        });

        // Fazer pergunta
        async function fazerPergunta() {
            const pergunta = perguntaInput.value.trim();
            
            if (!pergunta) return;

            // UI
            consultarButton.disabled = true;
            consultarButton.textContent = 'Consultando...';
            errorArea.classList.add('hidden');
            respostaArea.classList.add('hidden');
            loadingArea.classList.remove('hidden');
            exemplosArea.classList.add('hidden');

            try {
                console.log('üöÄ Enviando para:', CONFIG.webhookUrl);
                console.log('üìù Pergunta:', pergunta);
                
                const response = await fetch(CONFIG.webhookUrl, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ pergunta: pergunta })
                });

                console.log('üì° Status:', response.status);
                console.log('üì° OK:', response.ok);

                if (!response.ok) {
                    throw new Error(`Erro HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('‚úÖ Dados recebidos:', data);

                // Formata resposta
                let respostaTextoFinal, modelo;
                
                if (data.choices && data.choices[0] && data.choices[0].message) {
                    respostaTextoFinal = data.choices[0].message.content;
                    modelo = data.model || 'GPT-4o';
                } else if (data.resposta) {
                    respostaTextoFinal = data.resposta;
                    modelo = data.modelo || 'GPT-4o';
                } else if (typeof data === 'string') {
                    respostaTextoFinal = data;
                    modelo = 'GPT-4o';
                } else {
                    respostaTextoFinal = JSON.stringify(data, null, 2);
                    modelo = 'Resposta Raw';
                }

                // Mostra resposta
                respostaTexto.textContent = respostaTextoFinal;
                respostaModelo.textContent = `Modelo: ${modelo}`;
                respostaTimestamp.textContent = new Date().toLocaleString('pt-BR');
                
                loadingArea.classList.add('hidden');
                respostaArea.classList.remove('hidden');
                perguntaInput.value = '';
                
            } catch (err) {
                console.error('‚ùå Erro:', err);
                
                loadingArea.classList.add('hidden');
                errorArea.classList.remove('hidden');
                
                let mensagemErro = err.message;
                
                if (err.message.includes('Failed to fetch')) {
                    mensagemErro = `
üö® ERRO DE CONEX√ÉO

Causas poss√≠veis:
‚Ä¢ Workflow n√£o est√° ATIVO no n8n
‚Ä¢ CORS n√£o configurado corretamente
‚Ä¢ Falta o n√≥ "Respond to Webhook" no final do workflow

Verifique:
1. Workflow "Pol√≠ticas pt.2" est√° ativo (toggle verde)
2. N√≥ Webhook tem CORS habilitado (Options > CORS > *)
3. √öltimo n√≥ √© "Respond to Webhook" retornando JSON

URL: ${CONFIG.webhookUrl}
                    `.trim();
                }
                
                errorMessage.textContent = mensagemErro;
                exemplosArea.classList.remove('hidden');
            } finally {
                consultarButton.disabled = false;
                consultarButton.innerHTML = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg> Consultar';
            }
        }

        // Inicia
        checkAuth();
    </script>
</body>
</html>
